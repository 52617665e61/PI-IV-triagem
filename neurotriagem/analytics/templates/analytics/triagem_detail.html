{% extends 'base.html' %}
{% load static %}

{% block title %}Detalhes do Teste{% endblock %}

{% block content %}
<div class="background">
  <div class="container" style="padding: 40px; color: #fff;">

    <h2 style="text-align: center; font-family: 'Jacques Francois', serif;">
      {{ triagem.teste.nome }} — {{ triagem.usuario.first_name }} {{ triagem.usuario.last_name }}
    </h2>

    <div style="background-color: #d1cfcf; color: #000; padding: 20px; border-radius: 10px; margin: 30px auto; max-width: 700px;">
      <p><strong>Data de Envio:</strong> {{ triagem.data_envio|date:"d/m/Y H:i" }}</p>
      <p><strong>Revisado:</strong> {{ triagem.revisado|yesno:"Sim,Não" }}</p>

      {% if triagem.revisado %}
        <p><strong>Psicólogo Revisor:</strong> {{ triagem.psicologo_revisor.get_full_name }}</p>
        <p><strong>Comentário:</strong> {{ triagem.comentario_revisor|default:"-" }}</p>
        <p><strong>Data de Revisão:</strong> {{ triagem.data_revisao|date:"d/m/Y H:i" }}</p>
      {% endif %}
    </div>

    <h3 style="text-align: center; font-family: 'Jacques Francois', serif;">Respostas do Teste</h3>

    <form method="post">
      {% csrf_token %}
      <table style="width: 100%; border-collapse: collapse; background-color: #d1cfcf; color: #000; border-radius: 10px; overflow: hidden; margin-top: 20px;">
        <thead style="background-color: #0a0345; color: #fff;">
          <tr>
            <th style="padding: 10px;">Questão</th>
            <th style="padding: 10px;">Resposta</th>
          </tr>
        </thead>
        <tbody>
          {% for questao, resposta in respostas %}
            <tr style="border-bottom: 1px solid #aaa;">
              <td style="padding: 10px;">{{ questao }}</td>
              <td style="padding: 10px;">{{ resposta }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <div style="margin-top: 30px; background-color: #f0f0f0; padding: 20px; border-radius: 10px; max-width: 700px; margin-left: auto; margin-right: auto;">
        <label>
          <input type="checkbox" name="revisado" {% if triagem.revisado %}checked{% endif %}>
          Revisado corretamente
        </label>
        <br><br>
        <label for="comentario"><strong>Comentário do Psicólogo:</strong></label>
        <textarea name="comentario" id="comentario" rows="4" style="width: 100%;">{{ triagem.comentario_revisor }}</textarea>
        <br><br>
        <button type="submit" style="background-color: #3a8a3c; color: white; padding: 10px 20px; border-radius: 5px; border: none;">
          Salvar Revisão
        </button>
      </div>
    </form>

    <div style="text-align: center; margin-top: 30px;">
      <a href="{% url 'analytics:pacient_detail' triagem.usuario.id %}" 
         class="nav-btn" 
         style="background-color: #a06c0c; color: white; text-decoration: none; padding: 10px 20px; border-radius: 5px;">
         Voltar ao Paciente
      </a>
    </div>

  </div>
</div>
{% endblock %}
